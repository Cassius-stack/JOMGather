{% extends "base.html" %}

{% block title %}Review Display - Slice of Life{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <a href="{{ url_for('slice_of_life.prompt') }}" class="text-decoration-none text-muted d-block mb-2">
                <i class="bi bi-arrow-left me-1"></i>Back to Prompts
            </a>
            <h2 class="fw-bold mb-1">
                <i class="bi bi-eye text-primary me-2"></i>Review Mode
            </h2>
            <p class="text-muted mb-0">Review your combined display before publishing</p>
        </div>
        <span class="badge bg-success fs-6 py-2 px-3" style="border-radius: 12px;">
            <i class="bi bi-check-circle me-1"></i>Both Submitted
        </span>
    </div>

    <!-- Prompt Banner -->
    <div class="card border-0 shadow-sm mb-4"
        style="background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); border-radius: 16px;">
        <div class="card-body p-3 text-white text-center">
            <small class="text-uppercase opacity-75">Today's Prompt</small>
            <h5 class="mb-0 mt-1">"What is your favourite thing to do after school/work?"</h5>
        </div>
    </div>

    <!-- Side by Side Review Cards -->
    <div class="row g-4 mb-4">
        <!-- Your Submission (Youth) -->
        <div class="col-md-6">
            <div class="sol-review-card h-100">
                <div class="sol-review-header youth">
                    <img src="https://i.pravatar.cc/44?img=12" alt="You">
                    <div>
                        <strong>You</strong>
                        <span class="sol-author-badge youth ms-2">Youth</span>
                    </div>
                </div>

                <!-- Your Image -->
                <img src="https://images.unsplash.com/photo-1472745942893-4b9f730c7668?w=600&h=200&fit=crop"
                    alt="Your photo" class="sol-review-image">

                <div class="sol-review-content">
                    <!-- Your Thought -->
                    <h6 class="fw-bold mb-2"><i class="bi bi-chat-text text-primary me-2"></i>Your Thought</h6>
                    <div class="sol-review-thought">
                        "After school, I love going to the playground near my HDB. This photo is from last week -
                        I was just sitting on the swing, watching the sunset and decompressing from the day.
                        It's my peaceful escape."
                    </div>

                    <!-- Partner's Comment on Your Work -->
                    <h6 class="fw-bold mb-2"><i class="bi bi-chat-dots text-success me-2"></i>Grandma Rose's Comment
                    </h6>
                    <div class="sol-review-comment">
                        <p class="mb-0">"Wah, your playground looks so colourful! In my time, we just had wooden
                            seesaws.
                            But the feeling of watching sunset is the same - very calming right? üòä"</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Partner's Submission (Senior) -->
        <div class="col-md-6">
            <div class="sol-review-card h-100">
                <div class="sol-review-header senior">
                    <img src="https://i.pravatar.cc/44?img=25" alt="Grandma Rose">
                    <div>
                        <strong>Grandma Rose</strong>
                        <span class="sol-author-badge senior ms-2">Senior</span>
                    </div>
                </div>

                <!-- Partner's Image -->
                <img src="https://images.unsplash.com/photo-1517457373958-b7bdd4587205?w=600&h=200&fit=crop"
                    alt="Partner's photo" class="sol-review-image">

                <div class="sol-review-content">
                    <!-- Partner's Thought -->
                    <h6 class="fw-bold mb-2"><i class="bi bi-chat-text text-warning me-2"></i>Grandma Rose's Thought
                    </h6>
                    <div class="sol-review-thought">
                        "After work last time, I always go to the kopitiam near Toa Payoh.
                        This photo is my usual seat - same corner for 30 years! I drink kopi-o and chat with the uncle.
                        Very shiok."
                    </div>

                    <!-- Your Comment on Partner's Work -->
                    <h6 class="fw-bold mb-2"><i class="bi bi-chat-dots text-primary me-2"></i>Your Comment</h6>
                    {% if not your_comment_added %}
                    <form class="d-flex gap-2" onsubmit="addComment(event)">
                        <input type="text" class="sol-comment-input flex-grow-1" placeholder="Add your comment..."
                            id="yourComment">
                        <button type="submit" class="btn btn-primary px-3" style="border-radius: 12px;">
                            <i class="bi bi-send"></i>
                        </button>
                    </form>
                    {% else %}
                    <div class="sol-review-comment">
                        <p class="mb-0" id="yourCommentDisplay">"That kopitiam looks so cozy! I should visit Toa Payoh
                            and try the kopi-o.
                            Maybe you can recommend which stall? üôè"</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Completed Display Preview -->
    <div class="card border-0 shadow-sm mb-4" style="border-radius: 16px;">
        <div class="card-header bg-white border-0 py-3 px-4">
            <h5 class="mb-0"><i class="bi bi-image text-primary me-2"></i>Your Completed Display</h5>
            <small class="text-muted">This is how it will appear in the catalog</small>
        </div>
        <div class="card-body p-4">
            <div class="sol-completed-display">
                <!-- 2 Images Side by Side -->
                <div class="sol-completed-images">
                    <img src="https://images.unsplash.com/photo-1472745942893-4b9f730c7668?w=400&h=180&fit=crop"
                        alt="Youth's photo">
                    <img src="https://images.unsplash.com/photo-1517457373958-b7bdd4587205?w=400&h=180&fit=crop"
                        alt="Senior's photo">
                </div>

                <!-- Youth Section: Thought + Comment -->
                <div class="sol-completed-section youth-section">
                    <div class="d-flex align-items-center mb-2">
                        <img src="https://i.pravatar.cc/30?img=12" class="rounded-circle me-2" alt="You">
                        <span class="sol-author-badge youth">You (Youth)</span>
                    </div>
                    <p class="mb-2"><strong>Thought:</strong> "After school, I love going to the playground near my
                        HDB..."</p>
                    <p class="mb-0 text-muted fst-italic"><i class="bi bi-reply me-1"></i><strong>Grandma Rose
                            commented:</strong> "Wah, your playground looks so colourful!"</p>
                </div>

                <!-- Senior Section: Thought + Comment -->
                <div class="sol-completed-section senior-section">
                    <div class="d-flex align-items-center mb-2">
                        <img src="https://i.pravatar.cc/30?img=25" class="rounded-circle me-2" alt="Grandma Rose">
                        <span class="sol-author-badge senior">Grandma Rose (Senior)</span>
                    </div>
                    <p class="mb-2"><strong>Thought:</strong> "After work last time, I always go to the kopitiam near
                        Toa Payoh..."</p>
                    <p class="mb-0 text-muted fst-italic"><i class="bi bi-reply me-1"></i><strong>You
                            commented:</strong> "That kopitiam looks so cozy!"</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Publish Section -->
    <div class="sol-publish-card">
        <h5 class="fw-bold mb-3"><i class="bi bi-send text-success me-2"></i>Ready to Publish?</h5>
        <p class="text-muted mb-4">Your combined display is complete with 2 images, 2 thoughts, and 2 comments!</p>

        <form method="POST" action="{{ url_for('slice_of_life.publish', display_id=display_id) }}">
            <!-- Privacy Options -->
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="sol-privacy-option selected w-100" onclick="selectPrivacy(this, 'public')">
                        <input type="radio" name="privacy" value="public" checked class="d-none">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-globe fs-4 text-primary me-3"></i>
                            <div>
                                <strong>Public</strong>
                                <p class="text-muted small mb-0">Share in the catalog for everyone</p>
                            </div>
                        </div>
                    </label>
                </div>
                <div class="col-md-6">
                    <label class="sol-privacy-option w-100" onclick="selectPrivacy(this, 'private')">
                        <input type="radio" name="privacy" value="private" class="d-none">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-lock fs-4 text-secondary me-3"></i>
                            <div>
                                <strong>Private</strong>
                                <p class="text-muted small mb-0">Only you and your partner can see</p>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex gap-3">
                <button type="submit" class="btn btn-success btn-lg flex-grow-1" style="border-radius: 12px;">
                    <i class="bi bi-check-lg me-2"></i>Publish Display (+10 points)
                </button>
                <button type="button" class="btn btn-outline-secondary btn-lg" style="border-radius: 12px;">
                    <i class="bi bi-pencil me-1"></i>Edit
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function selectPrivacy(element, value) {
        // Remove selected from all options
        document.querySelectorAll('.sol-privacy-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        // Add selected to clicked option
        element.classList.add('selected');
        // Check the radio
        element.querySelector('input[type="radio"]').checked = true;
    }

    function addComment(e) {
        e.preventDefault();
        const comment = document.getElementById('yourComment').value;
        if (comment.trim()) {
            // Replace form with comment display
            const form = e.target;
            form.innerHTML = `
            <div class="sol-review-comment">
                <p class="mb-0">"${comment}"</p>
            </div>
        `;
        }
    }
</script>
{% endblock %}